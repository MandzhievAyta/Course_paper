Design of HyQ – a Hydraulically and Electrically Actuated Quadruped Robot  Apart from permitting the development of legged systems that can adapt to terrain irregularities the compliance can also assist to reduce energy consumption, or to improve robot performance by achieving mechanical power peaks that were not obtainable with a stiff structure. However, the flexibility introduced into the transmission also constitutes a limiting factor to the tracking performance that can be obtained by the control system. The dynamics of these systems are much more complex than those of a stiff robot. The intrinsic compliance induces oscillations of large amplitude and lowers the natural frequency.
To prevent the generation of these oscillations, the bandwidth of the controlled system usually has to be substantially lowered compared to the closed loop bandwidth of a rigid robot. This considerably limits the performance of the robot and impedes precise control during dynamic motions. This trade-off has to be addressed carefully. One possibility is to select suitable spring stiffness and damping coefficients to match the robot’s mass, kinematics and ground properties. This approach however creates a special purpose machine with lack of versatility, since optimal hopping frequency, robot mass and spring stiffness are strongly related. Variable stiffness devices would be beneficial, but they are currently difficult to apply to multi-degree-of-freedom robots due to their mechanical complexity, size, weight and integration [13]. Therefore, a more interesting alternative is to actively control leg stiffness by means of torque-controlled joints. In the latter case, only a limited amount of physical passive compliance at the foot is necessary, primarily to cope with the initial impact to avoid chattering of the foot [14].
As electric motors currently neither have a high power-to-weight ratio, nor are able to simultaneously provide the speed and forces necessary for highly dynamic robots, other methods of actuation are commonly sought after.
Although less common as a power source for legged robots, pneumatic actuation systems have potential to deal with these performance demands and impact scenarios. There have been two interesting and important alternatives to electric motors.
Pneumatic cylinders for example actuate the joints of the biped robot Dexter [15] and the quadruped robot Airhopper [16].
Both robots are able to perform vertical jumps and robustly land on their legs. At the same time, braided pneumatic Muscle Actuator (pMA) driven robots, such as the jumping biped Mowgli [17] and the quadruped Salford Pneumatic Dog [18], have shown the power generating potential and impact robustness of this muscle-type pneumatic actuation technology.
Yet while pneumatic muscles are able to provide an explosive force in a short time, they are difficult to control due to their highly non-linear output force to contraction relation and large hysteresis [19]. Like biological muscles, they are unidirectional acting elements. Therefore, antagonistic configurations with two muscles are necessary to actuate one conventional revolute joint. On the other hand, pneumatic cylinders are easier to control, but they suffer from a low control bandwidth due to their intrinsic compliance (air compressibility) and low power-to-weight ratio [20]. Therefore, both types of pneumatic actuator are less suitable for multi-gait legged robots.
Raibert et al. developed several mono-, bi- and quadruped robots in the 1980’s and in the early 1990’s that were able to perform highly dynamic tasks, including running, hopping and even somersaults [21]. Most of their robots were actuated by hydraulic cylinders with pneumatic springs in their legs [22]. About 15 years later, Hyon et al. developed the hydraulic oneand two-legged hopping robots Kenken with articulated legs and mechanical springs [23].
A lot of the success of these examples of legged robots was due to their actuation system performance. Hydraulic actuators have a wider dynamic range, are more powerful than pneumatic actuators, have an excellent power-to-weight ratio, high bandwidth and intrinsic compliance to a certain degree [24], fulfilling all the properties that are important for legged robots.
Therefore in some of the most successful of the recent legged robots, hydraulic actuation has become the dominant drive technology. Sarcos Inc. for example has a long-standing experience in compact hydraulic actuators having built several hydraulic humanoid robots [25][26] and recently a remarkable hydraulic exoskeleton. Boston Dynamics Inc., founded by Raibert in 1992, has been developing a hydraulic quadruped robot called BigDog.
BigDog is designed to be a rough-terrain mechanical mule that carries a significant payload to support soldiers. All of its 16 active joints (4 per leg) are actuated by hydraulic cylinders and powered either by an external hydraulic power pack or in external testing by an onboard internal combustion engine. BigDog has successfully performed different locomotion gaits such as walking, trotting and bounding, carried up to 154kg payload and hiked for 2.5 hours [27]. Unfortunately, little detail has been published about the design, component specifications and control algorithms to date and it is difficult to scientifically and independently validate the observations on the videos published on internet. Yet the underlying principle for this technology seems to be sound.
In this work the authors present HyQ (Hydraulic Quadruped), a versatile, fully torque-controlled 91kg robot with a combination of hydraulically and electrically actuated joints, that is designed to be capable of navigating over rough terrain and to perform highly dynamic tasks.
HyQ will provide a platform to study various aspects of quadrupedal locomotion, which aims to advance the state-of-theart of legged robots towards the goal of the development of useful all-terrain robots that assist human beings. As a Human Adaptive Mechatronics (HAM) machine, HyQ will assist in improving the skill and overall operation of the combined human machine system.
This paper is organised as follows: Section II explains the goals and specifications of the HyQ robotic platform. Section III presents the leg design, the results of prototype leg experiments and a hydraulic flow rate estimation. Section IV describes the final design of the quadruped robot and Section V reports the experimental results obtained with the quadruped robot.
Finally, section VI and VII contain the discussion, conclusions and further work.

The main goals of the development of the HyQ robot platform are the following: • The creation of a versatile robotic platform that is capable of performing highly dynamic tasks such as running and jumping, and is able to move autonomously (in terms of energy and control) in difficult terrain, where wheeled robots cannot go.
• To study biologically inspired locomotion by focusing on dynamic running gaits and the importance of (adjustable) joint compliance, energy-efficiency, gait pattern generation, gait transitions and robot balancing skills.
• To study the applicability of hydraulic actuation to power legged robots and to test novel propulsion systems that increase the robot's energy-autonomy.

In order to achieve the first goal as mentioned in Section 2.1, a versatile robotic platform has to be constructed. Firstly, its targeted performance needs to be specified. Since only few high-performance dynamic legged machines have been constructed to date, it is difficult to define realistic performance targets such as types of gaits and maximum forward velocity. Therefore, inspiration was not only taken from these existing robots (e.g. Scout [11], KOLT [12] and BigDog [27]), but also from the animal kingdom. In nature, several quadruped running gaits can be observed, such as trotting, bounding or galloping. It has been generally accepted that quadruped animals choose the gait and preferred forward velocity to minimise energy consumption and to avoid injuries created by excessive musculoskeletal forces at foot touch-down [28][29].
The trot, which pairs diagonal legs, exhibits good energy efficiency over a wide range of running speed, shows no significant pitch or roll motion during each stride and therefore is often seen in nature [30]. Several robots with similar dimensions and mass to HyQ, such as KOLT [12] and BigDog [27] have successfully demonstrated trotting. Furthermore, the trot gait also works down to very low forward velocity as demonstrated by KOLT and BigDog, but this is not seen in nature since walking gaits are generally more energy efficient for low velocities [28]. Nevertheless, the low velocity trot is a useful feature for legged robots. It simplifies their control in an early testing stage, as a wide range of forward velocities can be tested without the implementation of walk/trot gait transition. Thus the trot seems to be a suitable gait for dynamic legged robots.
Heglund and Taylor studied a large range of running quadruped animals (from mice to horses) and concluded that common trotting speeds and stride frequencies are directly related to the animal’s body mass [31]. Table I lists these results for a range of 50-90kg body mass. These values constitute the base to define the maximum targeted trotting speed of HyQ.

Based on the above mentioned considerations and inspirations, the performance targets for HyQ were defined as follows: • Ability to walk with different gaits: static walk over flat and rough terrain (always a minimum of three feet on the floor) and walking trot (diagonal leg pairs move together, always a minimum of two feet on the ground), as defined in [32] (see Section 3.1.1, 3.1.3).
• Ability to run with different gaits: flying trot (diagonal leg pairs move together and the robot experiences a flight phase between the steps) and bound (front leg pairs and hind leg pairs move together, with flight phase [32]). A maximum trotting speed of 2-3m/s is the target based on the preferred trotting velocity of quadruped animals of similar size, as shown in Table I (see Section 3.1, 3.2).
• Ability to keep balance in presence of unexpected disturbances such as rough or slippery terrain or external forces acting on robot (see Section 3.1.1, 4.3).
• Ability to perform a vertical jump from squat posture with a jump height of 0.15m, which is defined as the vertically travelled distance of robot centre of mass (COM) after all feet have left the ground. This target has been used for the joint torque estimation presented in [33].

• Ability to perform a safe and stable landing after dropping the robot from 0.15m, with initial impact on either all four feet or a pair of diagonal legs as worst case scenario (see Section 4.1).
• Power autonomy for several hours without recharging or refuelling (see Sections 2.3, 7).

Based on the above performance requirements, the physical specifications such as the estimated robot size and weight were identified. These are important values that directly influence component selection, robot geometry and mechanical structure.
Highly dynamic motions such as running trot, squat jumping, disturbance rejection, can be achieved by hydraulically actuated joints, which are able to provide the necessary high speed and high power-to-weight ratio, as stated earlier in the introduction. In order to satisfy the power autonomy requirement, the robot has to carry a complete onboard hydraulic and power supply system. The majority of the commercially available components of these systems are rather bulky, which influences the dimensions of the robot torso that has to accommodate all components. The first indoor version of the robot was constructed with an onboard hydraulic system tethered to an external electric power supply. Initially, the minimum length of the robot torso was estimated to be approximately 1 meter to provide the space for all hydraulic and other system components. As discussed in Section 3.1.4, the torso length directly influences the length of the leg. The robot weight of the electrically tethered version was estimated to be around 91kg [33].

Walking and running machines distinguish themselves from other moving machines by the fact that they use legs for locomotion, making worthwhile a careful study of the leg design. This section presents the details of the design of the HyQ quadruped robot leg, a study to estimate required hydraulic flow rates and experimental results obtained with a prototype leg.

The leg design is influenced by the targets and specifications as defined in Section 2. Each leg features three actuated revolute degrees of freedom (DOF), which is the minimum required to allow a foot positioning in a three dimensional workspace around the hip. This reduces the complexity of the quadruped machine, but still enables static walking over rough terrain, robot balance and robust dynamic gaits.
As shown in Fig. 1a, inspired by animal and human leg anatomy, the three actuated joints are defined as follows: • hip a/a: Hip abduction/adduction, responsible for the lateral leg motion around the joint axis parallel to the longitudinal axis of the body (located between robot torso and hip assembly; represented by q0).
• hip f/e: Hip flexion/extension, responsible for the leg motion that brings the knee closer/further from the hip a/a joint axis (located between hip assembly and upper leg; represented by q1).
• knee f/e: Knee flexion/extension, responsible for creating motion in the same plane as the hip f/e joint. Together, they move the foot closer/further from the hip a/a joint axis (located between upper and lower leg; represented by q2).
An additional DOF has been added between the lower leg and the robot foot to create a passive prismatic joint, which is named ankle due to its position on the leg. Fig.1a shows a picture of the leg with descriptions of leg segments, actuators and joints. The kinematic structure of the leg can be found later in the text in Fig. 8b.
While the first running and hopping robots had prismatic “pogo-stick” legs like most of Raibert’s hoppers [21] or Scout [11], HyQ features articulated/segmented legs. This type of legs is more suitable for a versatile robot that is designed not only to run and hop, but also to carefully navigate over rough terrain. Furthermore, segmented legs are believed to increase the stability during running [34].
A list of most commercial actuator parts, components and sensors with exact model types is provided in the Appendix.

The three active leg joints are driven by either hydraulic or electric actuators, aiming to utilize the optimum characteristics of each actuation system [33]. Hydraulic cylinders were selected for the sagittal plane joints that require a high velocity, high power-to-weight ratio and robustness against torque peaks; namely for the hip f/e and knee f/e joint. On the other hand, brushless DC electric motors were chosen for the hip a/a joint, where a high power-to-weight ratio is less important and  The HyQ leg (LegV2): (a) picture with description of leg segments, actuators and joints; (b) sketch to define the leg segment lengths (l0, l1, l2, l3), the leg coordinate system (X-Z), joint angles (q0, q1, q2), spring compression (q3), joint torques (τ1, τ2) and vertical ground contact force (Fgz).

torque peaks are smaller, but compact dimensions are crucial. Since these electric motors can be mounted onto the robot’s torso, their mass does not increase the leg inertia. Furthermore, the electric motor assembly (Fig. 2a) is more compact than a hydraulic cylinder (Fig. 2b) in its overall dimensions (thickness-to-length ratio) and therefore it permits a modular leg design with all actuators and components included. Moreover, each additional hydraulic DOF would add to the overall size and weight of the hydraulic system, as a bigger pump unit with a higher flow rate would be required.
For a correct actuator sizing and selection, a series of simulations for different robot tasks has been performed. Torque estimations have been obtained for a vertically jumping robot from a crouched position, which led to the selection of the hydraulic cylinder diameter and stroke. The specifications of the electric motor are based on the results of similar estimations. A detailed description of these simulations and the resulting selection and sizing of the actuators is presented in [33].
Table II summarizes the main specifications of the hydraulic and electric actuators. While the two hydraulic cylinders are directly acting between two leg segments, the brushless DC motor needs a gear reduction to increase the joint torque output.

Electric and hydraulic actuators of the HyQ leg V2: section views of the CAD models with component description: (a) electric DC brushless motor unit with harmonic gear, torque sensor and relative encoder, integrated into a compact package; (b) hydraulic cylinder with load cell and rod end. Note that the CAD model of the cylinder has been simplified.

Harmonic gears have been selected due to their compact dimensions, absence of backlash, high reduction ratio and low weight. The flat geometry of this gear type and the possibility to have a frameless version of the electric motor allowed the design of a compact motor package that houses the motor, gear, torque sensor and motor-to-leg connection, as shown in Fig.
2a.

The prismatic passive ankle joint, which is located along the axis of the lower leg tube (see l2+q3 in Fig. 1b), connects the lower leg via a spring to the foot. The spring helps to reduce impact force peaks at foot touch-down during running and rough terrain locomotion. Additional shock absorbance is provided by a 5mm visco-elastic rubber layer on the foot. This layer also serves to increase foot friction on the ground leading to improved leg traction. Spring compression is measured with a linear potentiometer. This allows both the calculation of the foot position with respect to the robot torso and an estimation of the ground contact force based on Hook’s law. The foot is designed to be robust, but light-weight (low unsprung mass [21]) and with the ability to accommodate various springs of different stiffnesses (20N/mm, 50N/mm and 109N/mm). The maximum range of the ankle joint is 0.035m.
The overall stiffness of the leg is a combination of active and passive (spring) components. The virtual leg stiffness between the imaginary line from the foot contact point and the hip a/a joint can be adjusted by torque controlled joints.
While the compliant foot is crucial to absorb the initial impact and avoid chattering (rebouncing foot), the contribution of the added energy efficiency is part of an ongoing study.

The two main points that are crucial for the mechanical design of any dynamic robot leg are low leg inertia and robustness, requiring a careful selection of the structure and the materials. As shown in Fig. 1a, the HyQ leg structure is mainly composed of parallel plates, cylindrical tubes and their interfacing parts. Parallel plates interconnected by rods create a light and robust configuration, permitting the hydraulic cylinders to enter the leg structure when they are completely retracted.
Furthermore, the plates allow a simple integration of the two ball bearing pairs, which create robust and low-friction joints for hip f/e and knee f/e. A tubular structure has been chosen for the hip assembly to permit a strong leg-to-torso connection, since multiple ball-bearings along this tube help to spread the load. The foot is composed of a tube that slides inside lowfriction linear ball bearings.
A light-weight yet robust structure is achieved by using mainly two materials for HyQ’s legs. The majority of the parts have been constructed in Ergal, a strong aluminium alloy (type 7075) that is widely used in aerospace industry and for bicycle frames due to its excellent strength-to-weight ratio. The heavily stressed parts, such as the cylinder attachment shafts, the ball bearing supports, the joint end-stops, electric motor to leg connection, torque sensor and foot tube are constructed in stainless steel (AISI 303), which has a higher yield stress but also a higher density than Ergal.
Table III lists the mass and inertia properties of the leg segments and parts as defined in Fig.1a.

Inertial data has been estimated based on the CAD models of each leg segment with respect to the corresponding joint axis.
Since the leg-torso attachments and the electric motors are fixed to the torso, they are considered part of the torso in terms of mass/inertia. The inertia of the total leg has not been included in the table, as it depends on the joint positions.
The design of HyQ’s legs is based on the design and experimental studies of the first prototype 2-DOF leg presented in [35]. Several design issues were identified and improved for the current leg, which was named Leg Version 2 (Leg V2). It has a higher maximum hydraulic joint torque (145Nm instead of 125Nm), better and more sensors (increased load cell range from 4.4kN to 5kN, higher relative encoder resolution from 4096 to 80000 counts per revolution, added absolute encoder and foot position potentiometer), stronger joint end-stops and improved torque-to-joint position relation (better controllability for the complete joint range). A more detailed comparison of the two leg designs can be found in [33].
As mentioned in the Section 3.1.2 above, the leg is designed to be modular. This is achieved by mounting all leg components onto a single leg-torso attachment plate as shown in Fig. 1a. This modularity greatly simplifies the construction, debugging and maintenance of the robot, since each leg can easily be mounted and removed from the body as an independent unit.
Table IV lists the numerical values of the leg segment lengths l0 to l3 as shown in Fig. 1b, all lengths and angles that are depicted in Fig. 3, and the range of motion of all joints. All revolute joints have a range of motion of 120º, which is partly inspired by a goniometric study of Labrador-Retrievers as explained in [35]. The hip a/a joint ranges from -90º (leg lifted to horizontal position) to +30º (leg below the torso) with the definition of 0º for the leg perpendicular to the bottom plate of the torso. The 0º position of the other two joints is similarly defined for a completely straight leg, perpendicular to the bottom plate of the torso. The joint positions shown in Fig. 3a and Fig. 3b are q1=-53º and q2=110º. Note that throughout this paper the variables of the hip f/e and knee f/e joint carry the subscript “1” and “2”, respectively. The position of the passive ankle joint and therefore the length between the knee axis and the centre of the semi-spherical foot is expressed by (l2+q3), where q3 is the spring compression.
The segment lengths were determined based on the size of commercial hydraulic cylinders that meet the force requirements, and on the desired leg length. A fully stretched leg in relation to the distance between the hip f/e joints of the front and hind legs, as listed in Table V in Section 4.1, should approximate a 1:1 ratio for a fast and dynamic racing dog according to the findings of [36].

While the output torque profile of the electric motor is constant with respect to joint position, the hydraulic joints have a non-linear torque profile in relation to joint angle. This is due to the cylinder attachment geometry and the varying effective lever length Leff1 and Leff2. Fig. 3 shows the kinematics of the two hydraulic joints with the definition of the geometric parameters (lengths and angles). The corresponding numerical values are listed in Table IV.

Definition of the cylinder attachment geometries: (a) hip f/e joint: definition of the constant cylinder attachment lengths (a1, b1), the variable cylinder extension length (c1), the constant cylinder attachment angle (e11), the effective lever arm (Leff1) and the joint angle (q1) shown as q1=-53°; (b) knee f/e joint: definition of the constant cylinder attachment lengths (a2, b2), the variable cylinder extension length (c2), the constant cylinder attachment angles (e21,e22), the effective lever arm (Leff2) and the joint angle (q2) shown as q2=110°.

To obtain these torque profiles, the relationship between the hip f/e joint angle q1 and the cylinder extension length c1 has to be calculated first: Referring to Fig. 3 and by applying the law of cosines we can obtain  Similarly, the nonlinear relationship between the knee f/e joint angle q2 and the cylinder extension length c2 can be expressed as  Note that q1 is negative in the position shown in Fig. 3a.
Again, based on the law of cosines, the auxiliary angle β1 can be expressed as follows  which leads to the effective lever arm Leff1 of the hip f/e joint:  Leff 1 = a1 sin (β 1 ) = a1 ⋅ sin ⎜⎛ cos −1 ⎜⎛ a12 + c12 − b12 ⎟⎞ ⎟⎞ ⎜⎝ ⎜⎝ 2a1c1 ⎟⎠ ⎟⎠  Leff 2 = a2 sin (β ) = a2 ⋅ sin ⎜ cos −1 ⎜⎛ a2 2 + c2 2 − b2 2 ⎞⎟ ⎞⎟ ⎛ 2 ⎝⎜ ⎜⎝ 2a2c2 ⎟⎠ ⎟⎠  Equation (5) leads to the torque profile for the hip f/e joint:  τ 1 (q1 ) = Fcyl ⋅ Leff 1 = Fcyl ⋅ a1 ⋅ sin ⎝⎜⎜⎛ cos −1 ⎝⎜⎜⎛ a12 +2ca112c1− b12 ⎠⎟⎟⎞ ⎠⎟⎟⎞  and similarly, (7) leads to the torque profile for the knee f/e joint:  τ 2 (q2 ) = − Fcyl ⋅ Leff 2 = − Fcyl ⋅ a2 ⋅ sin ⎜ cos −1 ⎜⎛ a2 2 + c2 2 − b2 2 ⎞⎟ ⎞⎟ ⎛ ⎜⎝ ⎝⎜ 2a2c2 ⎟⎠ ⎟⎠  where Fcyl is the force created by the cylinder along its axis (neglecting friction):  where PA and PB are the hydraulic pressures inside the cylinder chamber A and B, respectively and Ap and Apr are the piston and piston ring areas of the cylinder as specified in Table II.
Based on (10), the numerical values for maximum operating pressure and piston areas as listed in Table II, a maximum cylinder force Fcyl of 3216N and 1968N is obtained for extending and retracting cylinder motion, respectively.
Subsequently, the maximum torque profiles with respect to joint angle can be calculated according to (8)-(9), see Fig. 4.

For a proper sizing of hydraulic system components, the required oil flow for different modes of operation (e.g. walk, run) has to be estimated. These flow profiles are important as they directly influence the size of the onboard pump, tank, cooler and pump motor/engine, and therefore the total robot mass.

Plot of maximum hydraulic actuator torque (absolute value) vs. joint angle for extending (solid line) and retracting (dash-dotted line) cylinder motion for: (a) hip f/e joint and (b) knee f/e joint.

The flow Qhdu inside a hydraulic drive unit that consists of a cylinder and a valve can be expressed as follows  with leg segment lengths (l0, l1, l2, l3) and joint angles (q1, q2) defined in Fig. 1b and 3 with the corresponding numerical values listed in Table IV. Note that q3 has been assumed 0, as it is a passive joint. This way, a non-quadratic Jacobian matrix that cannot be inverted, was avoided. This assumption is valid for a leg in the air and has been used for the following simulation to avoid unnecessary complexity.
Sakakibara et al. [37] proposed the composite cycloid foot trajectory that results in smooth joint trajectories for both velocity and acceleration. This trajectory generator takes the step length, height and step phase times as parameters. Two  where c&cyl is the velocity of the cylinder rod; Qleak is the leakage flow in the valve and cylinder and Qcomp is the  compressibility flow in the lines and volumes. For an approximate analysis of a system with overlapped spool valves, Qlc can be neglected.
Equations (10-12) show that an increasing piston area Ap of a moving cylinder not only increases output force, but also the required additional flow. The required joint torque of a legged robot depends on the robot mass, which in turn depends on the size of the onboard components.
One way of tackling this cyclic problem is to split it into two parts. Based on a first estimation of the total robot mass, a torque estimation can be performed that results in peak joint torques and consequently cylinder forces and piston areas (reported in [33]). In a second step, the joint position trajectories of different locomotion speeds have to be approximated giving rise to an estimation of the required hydraulic flow using (2), (6) and (11-12). For a rough approximation with reduced complexity, it is sufficient to perform a planar kinematic analysis, without considering rigid body dynamics and thus complex high-level locomotion controllers.
One way of obtaining meaningful joint position profiles is to first generate foot trajectories that are then transformed into joint trajectories by the inverse of the leg Jacobian matrix J:  where q&1 , q&2 are the velocities of the active joints and X& F , Z& F the derivation of the foot position, which is defined as the  contact point between the foot and the horizontal ground plane, expressed in the coordinate system shown in Fig. 1b. The leg Jacobian matrix is obtained by differentiating the forward kinematics  ⎡⎢ X F ⎤⎥ = ⎡⎢ − l1 sin( q1 ) − l2 sin( q1 + q2 ) ⎤⎥ ⎣ Z F ⎦ ⎣− l0 − l1 cos( q1 ) − l2 cos( q1 + q2 ) − l3 ⎦  gaits were modelled and simulated: one for walking and one for trotting. Fig. 5a illustrates plots of the foot trajectory used to approximate a 2m/s trot with 0.8m step length, 0.05m step height, 0.4s step time and 50% duty factor.
From the inverse of the leg Jacobian matrix (16) and the relationship between joint angle and cylinder position (2) and (6), the cylinder rod velocity and the hydraulic flow profiles were obtained. Fig. 5b shows the predicted total flows of all 8 cylinders for walking and trotting up to 3m/s. Due to the properties of the selected foot trajectory, trotting velocities were only simulated from 1m/s and not for low velocities. This is acceptable since the main interest of this simulation is to obtain an estimation of peak flow demands.

Required hydraulic flow estimation: (a) plot of cycloid foot trajectory with 0.8m step length, 0.05m step height, 0.4s step time and 50% duty factor, shown in world and leg coordinates (as defined in Fig. 2b); (b) plot of the estimated total oil flow of all 8 hydraulic cylinders for walking (solid) and trotting (dashed) vs. forward velocity of robot.

The results show that a high flow rate is required for running. Currently commercially-available electric pump units, which can provide the necessary flow, are too large to fit on a legged robot of the size of HyQ. The present onboard electrically powered pump unit (see Fig. 10) is rated at 5 l/min (0.084·10-3 m3/s), which is enough for a normal speed walk. Fast running requires flow rates above 20 l/min (0.333·10-3 m3/s), which at present can be provided by an external hydraulic pump with a flow rate of 30 l/min (0.5·10-3 m3/s). For a power-autonomous outdoor version of HyQ, a pump with an onboard combustion engine will be ideal for providing the required flow for walking and running, as shown by BigDog [27].
Peak flow estimation studies during explosive motions (not reported in this work) were performed to size the accumulator and hose diameters.

A previously presented prototype leg [35] has been extensively used to test different hydraulic joint controllers [38][39] and to assess the performance of the hydraulic actuators, the suitability of the leg sensors and the overall robustness of the mechanical structure [33][40]. In this work, a periodic hopping experiment is presented to analyze joint torques, ground reaction forces and hydraulic flow rates. Single leg hopping is the base of running and therefore an effective way of assessing the dynamic capabilities of the quadruped robot with a less complex setup.
To better understand the following experimental results, note the subsequent parameters of the prototype leg geometry that are different from the HyQ Leg V2: l1=l2=0.3m, a1=a2=0.304m, b1=0.038m, b2=0.039m, e11=6°, e12=-24°, e21=9.5°, e22=-20°.
The angle e12 of the hip joint is defined correspondingly to e22 of the knee joint. The masses of hip assembly, upper leg and lower leg segment are 2.1kg, 1.5kg and 0.8kg, respectively. The maximum hydraulic torque output is 125Nm. All other values are identical to those of Leg V2.
The prototype leg was fixed to a vertical low-friction slider that allows the leg to move only in vertical direction, as shown in Fig. 6. The constraints of the slider allow neither forward nor pitch motion of the leg. Any force component that is not acting along the slider joint axis creates forces and moments on the slider carriage. Nevertheless, the slider friction is kept to a minimum owning to the use of 2 ball-bearing pulleys on each side of the slider. This experimental setup permits the execution of different trials, which can provide meaningful and significant results with respect to the leg performance and capabilities.

For the following experiments, various weights ranging from 2.5kg to 17.5kg were attached to the slider carriage and leg, which weigh 7.5kg together, to create a total leg weight up to approximately a quarter of the robot mass. To test for the worst case, the prototype leg used for these experiments was not equipped with the compliant ankle joint (q3=0m), but only the 5mm visco-elastic rubber coating of the foot was used. Fig. 6 shows a picture sequence of one complete hopping cycle of the leg (frequency 2.3Hz, leg weight 12.5kg).

Picture sequence of the periodically hopping leg experiment showing one cycle, from the top left to the bottom right (frequency 2.3Hz, leg weight 12.5kg). Time between two frames: 80ms  Figure 7 shows the obtained results of that hopping experiment. The top plot in Fig. 7a illustrates the hopping height from the ground measured on the slider. The constant horizontal line indicates the leg length of 0.525m and thus indicates when the leg touches the ground. The bottom plot shows the hydraulic flow to the cylinders according to (11)-(12) with the flow average of 1.66 l/min (27.6·10-6 m3/s) displayed by the horizontal line. Fig. 7b depicts the torque profiles of both joints and the vertical ground reaction force estimated by the load cell data and the transpose of the Jacobian matrix (16) that relates joint torque τ with the ground contact force FG :  Plots of two hopping cycles (Frequency 2.3Hz, leg weight 12.5kg): (a) Top: hopping height measured between ground and origin of leg coordinate system. Bottom: calculated total flow rate of hip and knee cylinder based on joint position data; (b) Top: calculated torques based on load cell and joint position data for hip f/e (solid) and knee f/e (dashed) joint. Bottom: calculated vertical ground reaction force at the foot.

The experiments showed that dynamic hopping with a high frequency and jump height can be achieved. Furthermore, the mechanical and structural design resisted the repeated impacts and was demonstrated to be robust. However, joint torque peaks were high in the knee joints and even exceeded the maximum actuator torque (125Nm) during leg impact. These peaks are well absorbed by the intrinsic overload capacity of a hydraulic system, as the oil pressure in the compressed cylinder chamber temporarily rises above the pump pressure and the elastic hoses expand slightly, creating a dampening effect. In such case, however, the control is temporarily lost and therefore the maximum joint torque output has been increased to 145Nm. Amongst other improvements mentioned in Section 3.1.4, the load cell has been replaced by a larger measurement range model, since they reached saturation during these experiments.
Scaling up the mean flow rate by a factor of four leads to an approximate value of the total flow of 6.7 l/min (0.112·10-3 m3/s) for a full robot pronking. A direct comparison with the results in Section 3.2 however, would not be accurate because the COM of a trotting robot with a 50% duty factor experiences a much smaller vertical travel with respect to single leg hopping, which has longer parabolic flight phases [12].

The Hydraulic Quadruped robot HyQ is built up of a robot torso and four identical legs. Fig. 8a shows a CAD model rendering of the full robot with a description of key parts and components. The kinematic structure of the robot with its 12 active and 4 passive DOF is shown in Fig. 8b.

Hydraulic quadruped robot HyQ: (a) CAD model of the robot body with the onboard hydraulic system including the explanation of the key robot parts and components; (b) kinematic structure of the 16-DOF robot.

The four legs are arranged on the torso in the forward/backward configuration, where the front and hind knees point to each other. Zhang et al. [41] conducted both simulation and experimental studies with their electric quadruped robot BiosBot and concluded that the forward/backward configuration is most suitable, since it reduces slippage between the feet and the ground and that it improves the overall motion performance.
Table V provides a summary of technical specifications of the robot, its actuators, sensors and control hardware.
The total mass of HyQ with onboard hydraulic system is 91kg. The mass of all four legs (hip assembly, upper and lower leg, and foot) is around 24kg, which is approximately 26% of the total robot mass. This corresponds to the upper limit of animals with a comparable body weight such as large dogs and small horses, which have a relative leg mass of 19-26% [42].
Fig. 9 shows a picture of HyQ standing on a custom-made laboratory treadmill. The robot torso has a trapezoidal-shaped cross section and its structure is based on a folded Ergal sheet of 3mm thickness with internal ribs to increase torsional robustness. This design yields the following advantages: simplicity, rigidity, low weight (10kg), easy manufacturability and great ability to mount and accommodate components.
Finite Element Model (FEM) analyses for the torso have been performed to obtain the minimum sheet thickness that provides enough torsional robustness. The worst case scenario, in which the robot falls from 0.15m with only a diagonal foot pair onto a hard surface, has been simulated. A range of sheet thicknesses from 1 to 4mm was tested for three foot designs with different levels of compliance: with spring and rubber coating (case A), with rubber only (case B) and without spring  Leg length (hip a/a axis to ground) (uncompressed spring)  from 0.339m (q0=0°, q1=-70°, q2=140°, q3=0m) to 0.789m (q0=0°, q1=-10°, q2=20°, q3=0m)  double-acting cylinders (80mm stroke and 16mm bore)  joint position (relative and absolute), joint torque, cylinder pressure, foot spring compression, IMU  Picture of the hydraulically and electrically actuated quadruped robot HyQ on a laboratory treadmill.

and rubber (case C). The results showed that case C produced Van Mises stresses higher than the material’s yield stress for all sheet thicknesses, since metal directly hits a very hard surface. Case A and B with minimum sheet thickness of 2mm produced acceptable stress (max. 320 MPa) and deflection levels (max. 7mm, measured between two diagonal corners of the torso). Consequently, a 3mm sheet has been selected, which creates a maximum stress of 215MPa and deflection of 2.9mm  for Case B. The weight difference between the 2mm and 3mm sheet is 3kg, which is acceptable due to the added robustness and failure tolerance that is important for a first torso prototype. The analyses confirmed the importance of the shockabsorbing rubber layer on the foot.

The onboard hydraulic system of HyQ consists of the following components: a pump powered by an AC electric motor, a 4-litre plastic oil tank, a heat exchanger with electric fan, a 0.7-litre accumulator, a filter, a central manifold with relief and vent valve, two valve manifolds each with four proportional spool valves and with eight pressure sensors, eight doubleacting cylinders, fittings, and hosing. Fig. 10 shows a picture of the hydraulic system mounted on the robot torso. The hydraulic valves that control the flow to the cylinder chambers are solenoid-operated proportional spool valves.

A top view of the robot showing the onboard hydraulic system with the explanation of its main components.

Based on the results discussed in Section 3.2, an external laboratory pump unit was used during the initial experiments with HyQ presented in Section 5.
An important part of a hydraulic system is the heat exchanger that keeps the oil temperature below a desired level. This is necessary in terms of safety to avoid fire hazard and to reduce changes in oil viscosity, which is temperature-dependent.
Changing oil viscosity can have a negative influence on the controller’s performance, since it affects the flow rate through the valve.
Various considerations and experiences with the hydraulic system are reported in Section 6.

A Pentium PC-104 computer and 5 data-acquisition boards constitute the onboard central processing unit of the robot. The low and medium level controllers are executed on the PC-104 running a real-time patched Linux (Xenomai). Low level joint controllers run at 1kHz, while higher level locomotion trajectories are generated at 200Hz on an external computer that communicates via Ethernet with the robot. The hydraulic joints are directly controlled by the PC-104, whereas the electric motors are commanded with a separate motor driver that communicates via CAN-bus with the robot.
The robot is equipped with a network of over 50 sensors for low and high level control, system state monitoring and diagnostics. Besides the sensors of the leg and the hydraulic system, HyQ is currently carrying an inertial measurement unit (IMU) mounted on the robot torso (3-axis acceleration, 3-axis gyro and compass sensor). The IMU is a crucial element towards robot balance and the goal of autonomous navigation.
HyQ is controlled by the robot controller software SL [43]. SL also allows simulating the dynamics of the robot by help of an articulated rigid body model. A comparison between simulated and experimentally obtained torques of a static walking motion are reported in Section 5. These results are a first steps towards confirming the validity of the dynamic model of the robot.
HyQ’s joint controllers use the force/torque sensor and encoder signals as feedback to close the control loop in position and force. Determining whether impedance or admittance control architectures are more suitable, and obtaining a smooth and reactive torque control are part of ongoing work.

For the preliminary testing of the robot hardware and software, a static walk was performed successfully on flat ground.
The joint position reference trajectories were generated offline for HyQ with the rigid body dynamics simulator SL and the locomotion controller of the Little Dog robot written by Kalakrishnan et al. [7]. In order to achieve a statically stable walk the ground projection of the COM has to stay always inside the support polygon that is spanned up by the three or four stance feet. The implemented walk cycle has a period of 14s and the step sequence of the legs can be summarized as follows: LH, LF, RH and then RF leg.
The same joint trajectories were both run on the HyQ simulator and on the real robot in position control mode. The robot was not constrained in any way and freely moving without a support both in simulation and during the real experiment. HyQ was powered by an external hydraulic pump to reduce the robot weight to around 70kg, which facilitates first experiments and robot handling. Since the surface was covered by a layer of rubber, a good traction between the robot feet and the ground was obtained that resulted in minimal foot slip during the walk.
Fig. 11a shows a plot of the reference, simulated and real (experimental) position tracking of the hip f/e and knee f/e joint of the LH leg for one walk cycle. The torques of the corresponding joints for both simulation and experiment are plotted in Fig. 11b. They were obtained by load cell measurements and (8)-(9).

Experimental vs. simulation results of HyQ during one period (14s) of a slow static walk shown for the hip f/e (top) and knee f/e (bottom) joints of the left hind (LH) leg: (a) position vs. time plots of experimental (real) data (solid line) and simulated (simu) data (dash dotted line) together with the position reference (ref) trajectory; (b) corresponding torque vs. time plots for experiment and simulation.

The comparison between the simulated and experimental data of joint torque and position shows that the HyQ simulator is able to produce meaningful results for slow robot motions. A corresponding comparison of more dynamic movements is currently under way. Possible causes for the oscillations at around 6-8s in the plot and the position tracking performance of the experiments shown in this work are discussed in Section 6. The first two seconds in the plots of Fig. 7b show that both joints are experiencing nearly zero torque, since the leg was executing the flight phase of its step cycle and therefore was not touching the ground. In the static conditions of this experiment, the only torques acting on the joints are due to the gravity force created by the leg weight.

For the second experiment, the RH leg of HyQ was used to test the position tracking performance of the hydraulic joints during fast motions. The robot was lifted off the ground so that the leg was able to move freely in the air. Additionally, the ankle joint and foot were replaced by a rigid foot. The cycloid foot trajectory presented in Section 3.2 was used to generate the joint reference trajectories.
Figure 12 depicts the trajectory tracking result of the foot motion with the same parameters as shown in Fig. 5a for a 2.5Hz motion (Fig. 12a) and 1Hz motion (Fig. 12b). The 2.5Hz experiment shows that very dynamic motions are possible with the robot leg, but the tracking performance is poor. The slower experiment has an acceptable performance, but both experiments  show that this velocity is near the limit of the actuator bandwidth, which is mainly restricted by the currently used valve type and long elastic hoses. These problems are further discussed in Section 6.

Foot trajectory tracking experiment with RH leg in the air for a cycloid foot trajectory with 0.8m step length, 0.05m step height and 50% duty factor, shown in X-Z leg coordinates (top) and for the knee f/e joint (bottom), experimental data (real, solid line) and reference data (ref, dash dotted line): (a) for 0.4s step time (2.5Hz); (b) for 1s step time (1Hz).

Hydraulic actuation inherently bears certain challenges when compared to electric motors. Oil-based systems, for example, can potentially have leakage if not properly handled. In the case of HyQ, external leakage only happened during changes of the system configuration, i.e. when opening and closing hydraulic connectors. Quick-release couplings minimize the amount of spilled oil and are used to connect HyQ’s cylinder hoses to the valve manifolds. Internal leakage is the flow between the two cylinder chambers and between the valve ports. Since the currently used proportional valves of HyQ have a 25% spool overlap and no pilot stage, internal leakage is very low. This means that the valves are normally closed for a zero control signal and therefore HyQ’s hydraulic joints are not back-driveable. Only the elasticity of the hoses creates a certain degree of joint compliance even with closed valves. This elasticity, however, is believed to have a negative impact on the controller bandwidth and has to be further analysed.
The position tracking performance of the two hydraulic joints of the leg has been studied for the experiments shown here.
Note that in Fig. 11 at around 6-8s both the torque and position of the hip f/e joint are oscillating, thus worsening position tracking performance. Similarly, just after the impact during the hopping experiments (Fig. 7) at around 0.3s the hip f/e joint shows big oscillation. They are mainly due to the low dynamic performance of the actuator unit, caused by the above mentioned hose elasticity and the low valve bandwidth. The spool overlap creates a significant dead-band in the valve that lowers the dynamic properties considerably [33]. While the changes in the actuator kinematics from the first to the second leg design led to a better tracking performance than that presented in [35], the unresolved bottleneck is the proportional valve that is used for both leg versions. Therefore, the performance of two-stage servovalves with zero overlap and faster response are currently being investigated along with the effect of hose length on the actuator bandwidth.
Working with strong and fast robots like HyQ imposes additional requirements to the robot design and handling compared to smaller robots. Practical experience with HyQ underlines the importance of a robust system with a low need of maintenance. Mechanical joint end stops, for instance, should be strong and able to stop a fast moving leg in case of electric or controller failures. Sensors should be easily replaced without changing the wiring. Furthermore, a safe robot handling requires special support constructions that are able to lift and lower the robot. Such a robot harness should also prevent the robot from falling. A wide treadmill is a helpful tool for robot locomotion experiments.

This work introduced the design of a new torque-controlled hydraulic quadruped robot called HyQ, which utilizes a combined actuation system merging the advantages of both hydraulic and electric movers.

This new robotic platform joins the high speed and torque capabilities of the hydraulic system for the forward/backward propulsion-based movements of the leg with compact overall dimensions of the electric actuators for the lateral leg motions.
As a result, the ability of the robot in performing dynamic tasks can be accompanied by a completely modular leg design for easy construction and maintenance.
This work introduced the goals of the HyQ project, the robot specifications and the quadruped robot with a focus on the leg design and the hydraulic actuation system. It then presented experimental results obtained with a leg prototype and the full quadruped robot.
Future work mainly focuses on the improvement of the existing hardware, controllers and the experimental study of dynamic and all-terrain robot locomotion. Hardware changes will deal with a reduction of robot weight and added cushioning that protects the robot during experiments without harness. Different foot designs with springs, dampers and force sensors are currently being designed and tested to answer the question of how much stiffness and damping is necessary.
While the compliant foot is important to avoid chattering, it is questionable whether temporary energy storage in springs can significantly increase the energy efficiency of robots like HyQ that is currently powered by an inefficient hydraulic actuation system. It is also not clear whether adjustable stiffness or damping at the foot level would be beneficial for dynamic motions.
In terms of hydraulic components, the proportional valves will be replaced by faster two-stage valves mounted closer to the cylinders to increase the controller bandwidth. To meet the target of energy-autonomy, a new onboard pump powered by a combustion-engine will be installed for outdoor operation.
Force/torque joint controllers have to be improved and various high level locomotion strategies need to be implemented for different gaits on various kinds of terrain. Laser range finder, stereo cameras and other navigation sensors will be added to work towards the goal of autonomous navigation on challenging terrain.

We would like to acknowledge the contributions of Jonas Buchli, Marco Frigerio, Thiago Boaventura, the team of our technicians and especially the CLMC lab of Stefan Schaal at the University of Southern California for providing us with the SL software package and the code used for their Little Dog experiments.

proportional spool valve brushless DC motor gear reduction drives relative optical encoder absolute magnetic encoder strain-gauge load cell linear potentiometer inertial measurement unit  cylinder attachment constants of ith hydraulic joint piston and piston ring (annulus) area of the hydraulic cylinder auxiliary angle of ith hydraulic joint variable cylinder extension length of ith hydraulic joint cylinder rod velocity for a general hydraulic cylinder